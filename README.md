

# Проект интеграции LMS и Telegram бота

Этот проект интегрирует систему управления обучением (LMS) на базе Flask с Telegram ботом, предоставляя пользователям уведомления, информацию о курсах и рекомендации на основе искусственного интеллекта прямо через Telegram.

## Возможности

### LMS Платформа (Flask)
- **Роли пользователей:** Поддержка студентов, преподавателей и администраторов.
- **Управление курсами:** Преподаватели могут создавать, управлять и архивировать курсы, модули и уроки.
- **Задания и оценивание:** Создание заданий с дедлайнами, оценивание работ и предоставление обратной связи.
- **Система тестирования:** Создание тестов с различными типами вопросов.
- **ИИ-рекомендации:** Интегрированный "советник" генерирует персонализированные рекомендации для студентов.
- **Уведомления:** Комплексная система уведомлений о всех важных событиях.
- **REST API:** Защищенный API для интеграции с внешними сервисами, такими как Telegram бот.

### Telegram Бот
- **Интеграция с LMS:** Подключается к платформе LMS для получения данных в реальном времени.
- **Привязка аккаунтов:** Безопасная привязка Telegram аккаунта к профилю в LMS.
- **Меню по ролям:** Отображает различные клавиатуры и опции для студентов, преподавателей и администраторов.
- **Доступ к основным функциям:**
    - Просмотр курсов и заданий.
    - Проверка ближайших дедлайнов.
    - Просмотр оценок.
- **ИИ-анализ:** Предоставляет анализ успеваемости студента на основе ИИ по запросу.
- **Push-уведомления:** Проактивно отправляет рекомендации и важные уведомления из LMS.

## Структура проекта

```
/lms_project
├── lms_platform/         # Исходный код веб-приложения LMS на Flask
│   ├── app.py            # Основной файл приложения Flask
│   ├── api_routes.py     # API endpoints для бота
│   ├── templates/        # HTML шаблоны
│   ├── static/           # CSS, JS и файлы изображений
│   └── instance/         # Здесь хранится файл базы данных SQLite
├── telegram_bot/         # Исходный код Telegram бота
│   ├── bot.py            # Основной файл бота
│   ├── config.py         # Конфигурация бота и API
│   ├── database.py       # Управление локальной базой данных SQLite бота
│   ├── handlers/         # Обработчики сообщений и callback-запросов
│   └── services/         # Сервисы для взаимодействия с LMS API и ИИ
├── .env.example          # Пример файла переменных окружения
├── requirements.txt      # Python зависимости для всего проекта
├── README.md             # Документация на английском
└── README_RU.md          # Этот файл (документация на русском)
```

## Установка и настройка

### 1. Требования
- Python 3.10 или выше
- `pip` для управления пакетами
- Токен Telegram бота (получите его у [BotFather](https://t.me/botfather))

### 2. Размещение проекта

Разместите директорию `lms_project` в удобном для вас месте.

### 3. Создание виртуального окружения

Настоятельно рекомендуется использовать виртуальное окружение для управления зависимостями.

```bash
# Перейдите в корневую директорию проекта
cd /путь/к/lms_project

# Создайте виртуальное окружение
python3 -m venv venv

# Активируйте виртуальное окружение
# На Windows:
# venv\Scripts\activate
# На macOS/Linux:
source venv/bin/activate
```

### 4. Установка зависимостей

Установите все необходимые Python пакеты из файла `requirements.txt`.

```bash
pip install -r requirements.txt
```

### 5. Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта, скопировав пример.

```bash
cp .env.example .env
```

Теперь отредактируйте файл `.env` с вашими настройками:

```dotenv
# .env

# Конфигурация Telegram бота
# Замените на ваш токен от BotFather
BOT_TOKEN=7984059257:AAHfL_vL5b_yfdBzwj6AdyLl6bAT72jXUjw

# Конфигурация LMS API
# Это должен быть адрес, где запущена LMS платформа
LMS_API_BASE_URL=http://127.0.0.1:5000/api
LMS_API_KEY=lms_secret_key_for_bot

# Конфигурация OpenRouter AI (опционально, для ИИ-функций)
# Замените на ваш ключ с https://openrouter.ai/
OPENROUTER_API_KEY=ваш_ключ_openrouter

# Конфигурация администратора
# Ваш Telegram username (без @) или ваш числовой Telegram ID
ADMIN_TELEGRAM_ID=ShattIgor
```

## Запуск приложения

Вам необходимо запустить одновременно и LMS платформу, и Telegram бота. Лучше всего использовать для этого два отдельных окна терминала.

### Терминал 1: Запуск LMS платформы

```bash
# Убедитесь, что виртуальное окружение активировано
cd lms_platform

# Приложение инициализирует базу данных и запустит сервер
python3 app.py
```

LMS платформа будет доступна по адресу `http://127.0.0.1:5000`.
- **Демо вход преподавателя:** `teacher@demo.ru` / `123`

### Терминал 2: Запуск Telegram бота

```bash
# Убедитесь, что виртуальное окружение активировано
cd telegram_bot

# Бот инициализирует свою базу данных и начнет опрос сообщений
python3 bot.py
```

Теперь вы можете открыть Telegram и взаимодействовать с вашим ботом.

## Использование

### 1. Привязка Telegram аккаунта
1.  Начните диалог с вашим ботом в Telegram.
2.  Используйте команду `/start`.
3.  Бот попросит ввести email адрес, связанный с вашим аккаунтом в LMS.
4.  Введите email, который вы использовали для регистрации на платформе LMS (например, `teacher@demo.ru`).
5.  Бот подтвердит успешную привязку вашего аккаунта.

### 2. Взаимодействие с ботом
После привязки аккаунта бот предоставит клавиатуру меню в зависимости от вашей роли (Студент, Преподаватель или Администратор). Вы можете использовать это меню для:
- Просмотра ваших курсов.
- Проверки заданий и их статусов.
- Просмотра ближайших дедлайнов.
- Получения ИИ-анализа вашей академической успеваемости (для студентов).

## API Endpoints

LMS платформа предоставляет несколько API endpoints с префиксом `/api/` для бота. Аутентификация осуществляется через API ключ (заголовок `X-API-Key`).

- `GET /api/health`: Проверка работы API.
- `GET /api/user/by_telegram/<id>`: Получение профиля пользователя LMS по Telegram ID.
- `GET /api/user/<id>/courses`: Получение всех курсов для конкретного пользователя.
- `GET /api/user/<id>/assignments`: Получение всех заданий для пользователя.
- `GET /api/user/<id>/deadlines`: Получение ближайших дедлайнов.
- `GET /api/user/<id>/grades`: Получение оценок студента.
- `GET /api/recommendations/<id>`: Получение новых рекомендаций для пользователя.
- `POST /api/recommendation/<id>/mark_done`: Отметка рекомендации как выполненной.
- `POST /api/link_telegram`: Привязка Telegram ID к аккаунту пользователя LMS.
- `GET /api/user/<id>/notifications`: Получение уведомлений пользователя.

## Основные изменения и улучшения

### Что было исправлено:
1. **API интеграция:** Создан полноценный REST API в LMS платформе для взаимодействия с Telegram ботом.
2. **Реальные запросы:** Заменены заглушки в боте на реальные HTTP запросы к LMS API.
3. **Обработка ошибок:** Добавлена корректная обработка ошибок при недоступности API или отсутствии данных.
4. **Конфигурация:** Все настройки вынесены в переменные окружения для безопасности.
5. **Документация:** Создана подробная документация на русском и английском языках.

### Архитектура интеграции:
```
[Telegram User] <--> [Telegram Bot] <--> [LMS API] <--> [LMS Database]
                          |
                    [Bot Database]
                    (хранит связь telegram_id <-> lms_user_id)
```

## Рекомендации по развертыванию

### Для локального тестирования:
- Используйте адрес `http://127.0.0.1:5000` для LMS API.
- Запускайте оба сервиса в отдельных терминалах.

### Для production развертывания:
1. Используйте WSGI сервер (например, Gunicorn) для Flask приложения.
2. Настройте reverse proxy (например, Nginx) для LMS платформы.
3. Используйте HTTPS для безопасной передачи данных.
4. Измените `LMS_API_BASE_URL` на публичный адрес вашего сервера.
5. Используйте надежные пароли и API ключи.
6. Настройте автозапуск бота как системный сервис (systemd).

## Контакты и команда

Для вопросов и предложений обращайтесь к администратору:
- Telegram: @ShattIgor

Команда ПНВ (Поколение новых возможностей):

Цыгулина Арина
Тимлидер, аналитик, руководитель проекта, презентатор

Холджигитов Джасур
Администратор баз данных, разработчик Telegram ботов

Гогунская Евгения
Frontend – разработчик,аналитик

Кузнецова Анна
Дизайнер, макетирование на Figma

Рыженкова Алина
Backend - разработчик


Скринкаст: 
https://drive.google.com/drive/folders/12pOirYT8iT4wdRPtnr2W2J8lhJ0dyLvG?usp=sharing





